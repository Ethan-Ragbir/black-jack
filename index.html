<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Professional Blackjack Casino</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #0d4818, #1a5d24);
      color: white;
      overflow: hidden;
      height: 100vh;
    }

    .welcome-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .welcome-card {
      background: linear-gradient(135deg, #1a5d24, #0d4818);
      padding: 40px;
      border-radius: 15px;
      border: 3px solid #ffd700;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
    }

    .welcome-title {
      font-size: 2.5em;
      color: #ffd700;
      margin-bottom: 20px;
      font-weight: bold;
    }

    .input-group {
      margin: 20px 0;
    }

    .input-group label {
      display: block;
      margin-bottom: 10px;
      color: #ffd700;
      font-weight: bold;
    }

    .input-group input, .input-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid #ffd700;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 16px;
    }

    .btn {
      background: linear-gradient(135deg, #ffd700, #ffb347);
      color: #000;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      font-size: 16px;
      margin: 10px;
      transition: all 0.3s ease;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
    }

    .deposit-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin: 20px 0;
    }

    .deposit-btn {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
      border: 2px solid transparent;
      padding: 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .deposit-btn:hover, .deposit-btn.selected {
      border-color: #ffd700;
      transform: scale(1.05);
    }

    .hidden {
      display: none !important;
    }

    .game-container {
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: linear-gradient(180deg, #2c1810, #0d4818);
    }

    .game-header {
      background: rgba(0, 0, 0, 0.8);
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid #ffd700;
    }

    .player-info {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .balance {
      background: #28a745;
      padding: 8px 15px;
      border-radius: 20px;
      font-weight: bold;
    }

    .nav-tabs {
      display: flex;
      gap: 10px;
    }

    .nav-tab {
      background: transparent;
      color: white;
      border: 2px solid #ffd700;
      padding: 8px 20px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .nav-tab.active, .nav-tab:hover {
      background: #ffd700;
      color: #000;
    }

    .game-area {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    .table-surface {
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(ellipse 60% 40% at 50% 100%, #1a5d24, #0d4818),
        linear-gradient(180deg, rgba(44, 24, 16, 0.5), transparent);
      position: relative;
    }

    .dealer-area {
      position: absolute;
      top: 50px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
    }

    .dealer-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid #ffd700;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #1a472a, #0d4818);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
      overflow: hidden;
    }

    .dealer-speech {
      background: white;
      color: #000;
      padding: 10px 15px;
      border-radius: 15px;
      margin-top: 10px;
      max-width: 250px;
      font-weight: bold;
      position: relative;
    }

    .dealer-speech::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 8px solid white;
    }

    .dealer-cards {
      position: absolute;
      top: 150px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
    }

    .dealer-total {
      position: absolute;
      top: 270px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      padding: 8px 15px;
      border-radius: 10px;
      border: 2px solid #ffd700;
      color: #ffd700;
      font-weight: bold;
    }

    .player-hands {
      position: absolute;
      bottom: 150px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 40px;
      justify-content: center;
    }

    .hand {
      text-align: center;
      min-width: 150px;
    }

    .hand-info {
      background: rgba(0, 0, 0, 0.8);
      padding: 10px;
      border-radius: 10px;
      border: 2px solid #ffd700;
      margin-bottom: 10px;
    }

    .hand-bet {
      color: #ffd700;
      font-weight: bold;
      font-size: 1.1em;
    }

    .hand-total {
      color: white;
      margin-top: 5px;
    }

    .hand-total.bust {
      color: #ff4444;
    }

    .hand-total.blackjack {
      color: #00ff00;
    }

    .hand-cards {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 10px;
      min-height: 90px;
    }

    .hand-controls {
      display: flex;
      gap: 5px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .hand-controls button {
      background: #ffd700;
      color: #000;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      font-size: 12px;
    }

    .hand-controls button:disabled {
      background: #666;
      color: #ccc;
      cursor: not-allowed;
    }

    .hand-controls .btn-hit {
      background: #28a745;
      color: white;
    }

    .hand-controls .btn-stand {
      background: #dc3545;
      color: white;
    }

    .card {
      width: 60px;
      height: 85px;
      background: white;
      border: 2px solid #333;
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 4px;
      font-weight: bold;
      font-size: 12px;
      color: #000;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      position: relative;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card.red {
      color: #d32f2f;
    }

    .card.face-down {
      background: repeating-linear-gradient(
        45deg,
        #1a5d24,
        #1a5d24 8px,
        #0d4818 8px,
        #0d4818 16px
      );
      border-color: #ffd700;
    }

    .card.face-down::after {
      content: '🎰';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
    }

    .betting-area {
      position: absolute;
      bottom: 20px;
      left: 0;
      right: 0;
      text-align: center;
    }

    .chips {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 15px;
    }

    .chip {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 12px;
      color: white;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
      transition: all 0.3s ease;
      border: 3px solid rgba(255, 255, 255, 0.3);
    }

    .chip:hover {
      transform: scale(1.1) translateY(-5px);
    }

    .chip-5 { background: radial-gradient(circle, #ff6b6b, #d32f2f); }
    .chip-10 { background: radial-gradient(circle, #4ecdc4, #26a69a); }
    .chip-25 { background: radial-gradient(circle, #ffd700, #ff8f00); }
    .chip-50 { background: radial-gradient(circle, #9c27b0, #673ab7); }
    .chip-100 { background: radial-gradient(circle, #607d8b, #37474f); }

    .game-controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .game-controls button {
      background: #ffd700;
      color: #000;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .game-controls button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
    }

    .game-controls button:disabled {
      background: #666;
      color: #ccc;
      cursor: not-allowed;
    }

    .game-controls .btn-deal {
      background: #28a745;
      color: white;
    }

    .game-controls .btn-clear {
      background: #dc3545;
      color: white;
    }

    .stats-page {
      padding: 20px;
      height: 100%;
      overflow-y: auto;
      background: linear-gradient(135deg, #0d4818, #1a5d24);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stats-card {
      background: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #ffd700;
    }

    .stats-card h3 {
      color: #ffd700;
      margin-bottom: 15px;
      text-align: center;
      font-size: 1.3em;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      padding: 5px 0;
      border-bottom: 1px solid rgba(255, 215, 0, 0.3);
    }

    .stat-label {
      color: #ccc;
    }

    .stat-value {
      color: #ffd700;
      font-weight: bold;
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .modal-content {
      background: linear-gradient(135deg, #1a5d24, #0d4818);
      padding: 30px;
      border-radius: 15px;
      border: 3px solid #ffd700;
      text-align: center;
      max-width: 400px;
      width: 90%;
    }

    .modal-title {
      color: #ffd700;
      font-size: 1.8em;
      margin-bottom: 15px;
      font-weight: bold;
    }

    .modal-text {
      margin-bottom: 20px;
      line-height: 1.5;
    }

    .modal-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
    }

    @keyframes cardDeal {
      0% {
        transform: translateY(-100px) rotate(10deg);
        opacity: 0;
      }
      100% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
    }

    .card-dealing {
      animation: cardDeal 0.5s ease-out;
    }

    @media (max-width: 768px) {
      .chips {
        gap: 10px;
      }
      .chip {
        width: 40px;
        height: 40px;
        font-size: 10px;
      }
      .player-hands {
        gap: 20px;
      }
      .hand {
        min-width: 120px;
      }
      .card {
        width: 50px;
        height: 70px;
        font-size: 10px;
      }
    }
  </style>
</head>
<body>
  <!-- Welcome Screen -->
  <div id="welcome-screen" class="welcome-screen">
    <div class="welcome-card">
      <h1 class="welcome-title">🎰 Welcome to Elite Blackjack</h1>
      <div class="input-group">
        <label for="player-name">Enter Your Name:</label>
        <input type="text" id="player-name" placeholder="Your name" maxlength="15">
      </div>
      <button class="btn" id="name-continue-btn">Continue</button>
    </div>
  </div>

  <!-- Setup Screen -->
  <div id="setup-screen" class="welcome-screen hidden">
    <div class="welcome-card">
      <h2 class="welcome-title">🃏 Game Setup</h2>
      <div class="input-group">
        <label for="num-hands">Number of hands to play:</label>
        <select id="num-hands">
          <option value="1">1 Hand</option>
          <option value="2">2 Hands</option>
          <option value="3">3 Hands</option>
          <option value="4">4 Hands</option>
        </select>
      </div>
      <div class="input-group">
        <label for="min-bet">Minimum bet per hand:</label>
        <select id="min-bet">
          <option value="5">$5</option>
          <option value="10">$10</option>
          <option value="25">$25</option>
          <option value="50">$50</option>
        </select>
      </div>
      <button class="btn" id="setup-continue-btn">Continue</button>
    </div>
  </div>

  <!-- Deposit Screen -->
  <div id="deposit-screen" class="welcome-screen hidden">
    <div class="welcome-card">
      <h2 class="welcome-title">💰 Deposit Funds</h2>
      <div class="deposit-grid">
        <button class="deposit-btn" data-amount="500">$500</button>
        <button class="deposit-btn" data-amount="1000">$1,000</button>
        <button class="deposit-btn" data-amount="2500">$2,500</button>
        <button class="deposit-btn" data-amount="5000">$5,000</button>
        <button class="deposit-btn" data-amount="10000">$10,000</button>
        <button class="deposit-btn" data-amount="25000">$25,000</button>
      </div>
      <div class="input-group">
        <label for="custom-amount">Custom amount:</label>
        <input type="number" id="custom-amount" placeholder="Enter amount" min="100" max="100000">
      </div>
      <button class="btn" id="deposit-continue-btn">Start Playing</button>
    </div>
  </div>

  <!-- Game Container -->
  <div id="game-container" class="game-container hidden">
    <!-- Header -->
    <div class="game-header">
      <div class="player-info">
        <span id="player-name-display">Player</span>
        <div class="balance">Balance: $<span id="balance">0</span></div>
      </div>
      <div class="nav-tabs">
        <button class="nav-tab active" id="game-tab">Game</button>
        <button class="nav-tab" id="stats-tab">Statistics</button>
      </div>
    </div>

    <!-- Game Area -->
    <div id="game-area" class="game-area">
      <div class="table-surface">
        <!-- Dealer Area -->
        <div class="dealer-area">
          <div class="dealer-avatar">
            <svg width="80" height="80" viewBox="0 0 80 80">
              <!-- Background -->
              <circle cx="40" cy="40" r="38" fill="#2c1810"/>
              
              <!-- Face -->
              <rect x="25" y="25" width="30" height="35" fill="#d4a574" rx="5"/>
              
              <!-- Hair -->
              <rect x="22" y="20" width="36" height="15" fill="#8B4513" rx="8"/>
              
              <!-- Eyes -->
              <rect x="30" y="32" width="4" height="4" fill="#000"/>
              <rect x="46" y="32" width="4" height="4" fill="#000"/>
              
              <!-- Mustache -->
              <rect x="35" y="42" width="10" height="3" fill="#654321" rx="1"/>
              
              <!-- Bow tie -->
              <polygon points="35,55 45,55 40,50 35,55" fill="#fff"/>
              <polygon points="35,60 45,60 40,65 35,60" fill="#fff"/>
              <rect x="38" y="55" width="4" height="5" fill="#333"/>
              
              <!-- Vest -->
              <rect x="20" y="60" width="40" height="18" fill="#1a472a" rx="3"/>
            </svg>
          </div>
          <div id="dealer-speech" class="dealer-speech hidden">Welcome to the table!</div>
        </div>

        <!-- Dealer Cards -->
        <div id="dealer-cards" class="dealer-cards"></div>
        <div id="dealer-total" class="dealer-total hidden">Total: 0</div>

        <!-- Player Hands -->
        <div id="player-hands" class="player-hands"></div>

        <!-- Betting Area -->
        <div class="betting-area">
          <div class="chips">
            <div class="chip chip-5" data-value="5">$5</div>
            <div class="chip chip-10" data-value="10">$10</div>
            <div class="chip chip-25" data-value="25">$25</div>
            <div class="chip chip-50" data-value="50">$50</div>
            <div class="chip chip-100" data-value="100">$100</div>
          </div>
          <div class="game-controls">
            <button id="deal-btn" class="btn-deal">Deal Cards</button>
            <button id="clear-btn" class="btn-clear">Clear Bets</button>
            <button id="max-btn">Max Bet</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistics Page -->
    <div id="stats-page" class="stats-page hidden">
      <div class="stats-grid">
        <div class="stats-card">
          <h3>📊 Session Stats</h3>
          <div class="stat-row">
            <span class="stat-label">Hands Played:</span>
            <span class="stat-value" id="total-hands">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Hands Won:</span>
            <span class="stat-value" id="hands-won">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Hands Lost:</span>
            <span class="stat-value" id="hands-lost">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Pushes:</span>
            <span class="stat-value" id="pushes">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Blackjacks:</span>
            <span class="stat-value" id="blackjacks">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Win Rate:</span>
            <span class="stat-value" id="win-rate">0%</span>
          </div>
        </div>

        <div class="stats-card">
          <h3>💰 Financial Stats</h3>
          <div class="stat-row">
            <span class="stat-label">Starting Bankroll:</span>
            <span class="stat-value" id="starting-bankroll">$0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Current Balance:</span>
            <span class="stat-value" id="current-balance">$0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Total Wagered:</span>
            <span class="stat-value" id="total-wagered">$0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Net Profit/Loss:</span>
            <span class="stat-value" id="net-profit">$0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Biggest Win:</span>
            <span class="stat-value" id="biggest-win">$0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Average Bet:</span>
            <span class="stat-value" id="avg-bet">$0</span>
          </div>
        </div>

        <div class="stats-card">
          <h3>📈 Advanced Metrics</h3>
          <div class="stat-row">
            <span class="stat-label">Standard Deviation:</span>
            <span class="stat-value" id="std-deviation">0.00</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Variance:</span>
            <span class="stat-value" id="variance">0.00</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Expected Value:</span>
            <span class="stat-value" id="expected-value">$0.00</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Hot Streak:</span>
            <span class="stat-value" id="hot-streak">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Cold Streak:</span>
            <span class="stat-value" id="cold-streak">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">House Edge:</span>
            <span class="stat-value" id="house-edge">0.50%</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Insurance Modal -->
  <div id="insurance-modal" class="modal hidden">
    <div class="modal-content">
      <h3 class="modal-title">🛡️ Insurance</h3>
      <p class="modal-text">Dealer is showing an Ace. Take insurance?<br><strong>Cost: $<span id="insurance-cost">0</span></strong></p>
      <div class="modal-buttons">
        <button class="btn" id="take-insurance-btn">Take Insurance</button>
        <button class="btn btn-clear" id="decline-insurance-btn">No Thanks</button>
      </div>
    </div>
  </div>

  <!-- Result Modal -->
  <div id="result-modal" class="modal hidden">
    <div class="modal-content">
      <h2 class="modal-title" id="result-title">Hand Complete</h2>
      <div class="modal-text" id="result-details"></div>
      <div class="modal-text" id="result-payout" style="font-size: 1.5em; color: #ffd700; font-weight: bold;">+$0</div>
      <button class="btn" id="continue-btn">Continue</button>
    </div>
  </div>

  <script>
    // Game variables
    let playerName = '';
    let balance = 0;
    let startingBankroll = 0;
    let numHands = 1;
    let minBet = 5;
    let deck = [];
    let dealerHand = [];
    let playerHands = [];
    let currentHand = 0;
    let gameActive = false;
    let dealerRevealed = false;
    let insuranceTaken = false;

    // Statistics
    let stats = {
      totalHands: 0,
      handsWon: 0,
      handsLost: 0,
      pushes: 0,
      blackjacks: 0,
      totalWagered: 0,
      netProfit: 0,
      biggestWin: 0,
      biggestLoss: 0,
      sessionResults: [],
      betSizes: [],
      hotStreak: 0,
      coldStreak: 0,
      currentStreak: 0,
      streakType: 'none'
    };

    // Dealer quotes
    const dealerQuotes = {
      welcome: [
        "Welcome to my table, {name}! Ready for some blackjack?",
        "Good to see you, {name}! Let's play some cards.",
        "Hey {name}! Take a seat and let's get started.",
        "{name}, you're looking lucky today!"
      ],
      deal: [
        "Here we go, {name}! Cards coming out.",
        "Dealing for {name}. Good luck!",
        "Cards in the air, {name}!",
        "Let's see what you get, {name}!"
      ],
      hit: [
        "One more card, {name}!",
        "Card coming up for {name}!",
        "Here you go, {name}!",
        "Let's see what this brings, {name}!"
      ],
      stand: [
        "Standing pat, {name}? My turn now.",
        "{name} stands. Let's see what I have.",
        "Staying put, {name}? Here we go.",
        "{name} is done. Time for the dealer."
      ],
      win: [
        "Nice hand, {name}! You got me!",
        "Well played, {name}! That's a winner!",
        "Excellent, {name}! You beat the house!",
        "Great job, {name}! You're on fire!"
      ],
      lose: [
        "House wins this time, {name}.",
        "Not your hand, {name}. Next one's yours!",
        "Better luck next time, {name}.",
        "Cards weren't kind, {name}. Keep playing!"
      ],
      bust: [
        "Bust, {name}! Over 21.",
        "That's a bust, {name}. House wins.",
        "Too many points, {name}!",
        "Busted, {name}! Better luck next hand."
      ],
      blackjack: [
        "Blackjack, {name}! Outstanding!",
        "Natural 21, {name}! Perfect hand!",
        "{name} gets blackjack! That pays 3 to 2!",
        "Blackjack! Excellent work, {name}!"
      ],
      push: [
        "It's a push, {name}! We're even.",
        "Tie game, {name}! Your bet is returned.",
        "Same totals, {name}! Nobody wins.",
        "Push, {name}! We'll call it even."
      ]
    };

    // Initialize deck
    function buildDeck() {
      const suits = ['♠', '♥', '♦', '♣'];
      const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
      
      deck = [];
      for (let d = 0; d < 6; d++) {
        for (let suit of suits) {
          for (let value of values) {
            deck.push({ suit, value });
          }
        }
      }
      
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
    }

    // Helper functions
    function getHandValue(cards) {
      let value = 0;
      let aces = 0;

      for (let card of cards) {
        if (card.value === 'A') {
          aces++;
          value += 11;
        } else if (['K', 'Q', 'J'].includes(card.value)) {
          value += 10;
        } else {
          value += parseInt(card.value);
        }
      }

      while (value > 21 && aces > 0) {
        value -= 10;
        aces--;
      }

      return value;
    }

    function isBlackjack(cards) {
      return cards.length === 2 && getHandValue(cards) === 21;
    }

    function getCardValue(card) {
      if (card.value === 'A') return 11;
      if (['K', 'Q', 'J'].includes(card.value)) return 10;
      return parseInt(card.value);
    }

    function speak(message, duration = 3000) {
      const speechBubble = document.getElementById('dealer-speech');
      speechBubble.textContent = message;
      speechBubble.classList.remove('hidden');

      setTimeout(() => {
        speechBubble.classList.add('hidden');
      }, duration);
    }

    function getRandomQuote(category) {
      const quotes = dealerQuotes[category];
      const quote = quotes[Math.floor(Math.random() * quotes.length)];
      return quote.replace(/{name}/g, playerName);
    }

    function showScreen(screenId) {
      document.querySelectorAll('.welcome-screen, .game-container').forEach(screen => {
        screen.classList.add('hidden');
      });
      document.getElementById(screenId).classList.remove('hidden');
    }

    function updateDisplay() {
      document.getElementById('balance').textContent = balance;
    }

    function createCardElement(card, faceDown = false) {
      const cardEl = document.createElement('div');
      cardEl.className = 'card card-dealing';
      
      if (faceDown) {
        cardEl.classList.add('face-down');
        cardEl.dataset.faceDown = 'true';
      } else {
        if (card.suit === '♥' || card.suit === '♦') {
          cardEl.classList.add('red');
        }
        
        cardEl.innerHTML = `
          <div>${card.value}</div>
          <div style="font-size: 16px;">${card.suit}</div>
          <div style="transform: rotate(180deg);">${card.value}</div>
        `;
      }
      
      return cardEl;
    }

    function createPlayerHands() {
      const handsContainer = document.getElementById('player-hands');
      handsContainer.innerHTML = '';
      playerHands = [];

      for (let i = 0; i < numHands; i++) {
        const handDiv = document.createElement('div');
        handDiv.className = 'hand';
        handDiv.innerHTML = `
          <div class="hand-info">
            <div class="hand-bet">Bet: $<span id="bet-${i}">0</span></div>
            <div class="hand-total" id="total-${i}">-</div>
          </div>
          <div class="hand-cards" id="cards-${i}"></div>
          <div class="hand-controls">
            <button class="btn-hit" data-action="hit" data-hand="${i}" disabled>Hit</button>
            <button class="btn-stand" data-action="stand" data-hand="${i}" disabled>Stand</button>
            <button data-action="double" data-hand="${i}" disabled>Double</button>
            <button data-action="split" data-hand="${i}" disabled>Split</button>
          </div>
        `;
        handsContainer.appendChild(handDiv);

        playerHands.push({
          cards: [],
          bet: 0,
          active: false,
          finished: false,
          doubled: false,
          split: false
        });
      }
    }

    function updateHandDisplay(handIndex) {
      const hand = playerHands[handIndex];
      const betElement = document.getElementById(`bet-${handIndex}`);
      const totalElement = document.getElementById(`total-${handIndex}`);

      if (betElement) betElement.textContent = hand.bet;

      if (totalElement && hand.cards.length > 0) {
        const value = getHandValue(hand.cards);
        totalElement.textContent = `Total: ${value}`;

        totalElement.className = 'hand-total';
        if (value > 21) {
          totalElement.classList.add('bust');
        } else if (isBlackjack(hand.cards)) {
          totalElement.classList.add('blackjack');
        }
      } else if (totalElement) {
        totalElement.textContent = '-';
        totalElement.className = 'hand-total';
      }
    }

    function updateDealerDisplay() {
      const dealerTotal = document.getElementById('dealer-total');

      if (dealerHand.length === 0) {
        dealerTotal.classList.add('hidden');
        return;
      }

      const value = dealerRevealed ? 
        getHandValue(dealerHand) : 
        getCardValue(dealerHand[0]);

      dealerTotal.textContent = dealerRevealed ? 
        `Total: ${value}` : 
        `Showing: ${value}`;

      dealerTotal.classList.remove('hidden');
    }

    function updateAllDisplays() {
      for (let i = 0; i < playerHands.length; i++) {
        updateHandDisplay(i);
      }
      updateDealerDisplay();
    }

    function dealCardToPlayer(handIndex) {
      if (deck.length < 10) buildDeck();
      
      const card = deck.pop();
      playerHands[handIndex].cards.push(card);
      
      const cardElement = createCardElement(card, false);
      document.getElementById(`cards-${handIndex}`).appendChild(cardElement);
    }

    function dealCardToDealer(faceDown = false) {
      if (deck.length < 10) buildDeck();
      
      const card = deck.pop();
      dealerHand.push(card);
      
      const cardElement = createCardElement(card, faceDown);
      document.getElementById('dealer-cards').appendChild(cardElement);
    }

   function updateStatistics() {
  // basic counts
  document.getElementById('total-hands').textContent   = stats.totalHands;
  document.getElementById('hands-won').textContent    = stats.handsWon;
  document.getElementById('hands-lost').textContent   = stats.handsLost;
  document.getElementById('pushes').textContent       = stats.pushes;
  document.getElementById('blackjacks').textContent   = stats.blackjacks;

  // win rate
  const played = stats.handsWon + stats.handsLost + stats.pushes;
  const winRate = played > 0 ? (stats.handsWon / played * 100).toFixed(1) : 0;
  document.getElementById('win-rate').textContent = winRate + '%';

  // bankroll & balances
  document.getElementById('starting-bankroll').textContent = '$' + startingBankroll;
  document.getElementById('current-balance').textContent  = '$' + balance;
  document.getElementById('total-wagered').textContent    = '$' + stats.totalWagered;

  // net profit (+/−)
  const netSign = stats.netProfit >= 0 ? '+' : '-';
  document.getElementById('net-profit').textContent      = netSign + '$' + Math.abs(stats.netProfit);

  // biggest win
  document.getElementById('biggest-win').textContent     = '$' + stats.biggestWin;

  // average bet
  const avgBet = stats.betSizes.length
    ? (stats.betSizes.reduce((a,b) => a + b, 0) / stats.betSizes.length).toFixed(2)
    : '0.00';
  document.getElementById('avg-bet').textContent         = '$' + avgBet;

  // advanced metrics
  if (stats.sessionResults.length > 1) {
    const mean = stats.sessionResults.reduce((a,b) => a + b, 0) / stats.sessionResults.length;
    const variance = stats.sessionResults.reduce((sum, r) => sum + Math.pow(r-mean, 2), 0) 
                     / stats.sessionResults.length;
    const stdDev = Math.sqrt(variance);
    document.getElementById('std-deviation').textContent = stdDev.toFixed(2);
    document.getElementById('variance').textContent      = variance.toFixed(2);
    const evSign = mean >= 0 ? '+' : '-';
    document.getElementById('expected-value').textContent = evSign + '$' + Math.abs(mean).toFixed(2);
  } else {
    document.getElementById('std-deviation').textContent = '0.00';
    document.getElementById('variance').textContent      = '0.00';
    document.getElementById('expected-value').textContent = '$0.00';
  }

  // streaks
  document.getElementById('hot-streak').textContent = stats.hotStreak;
  document.getElementById('cold-streak').textContent = stats.coldStreak;

  // house edge
  const actualRTP = stats.totalWagered > 0
    ? ((stats.totalWagered + stats.netProfit) / stats.totalWagered * 100).toFixed(2)
    : 99.50;
  document.getElementById('house-edge').textContent = (100 - actualRTP).toFixed(2) + '%';
}


    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
      buildDeck();

      // Name continue
      document.getElementById('name-continue-btn').addEventListener('click', function() {
        console.log('Continue button clicked');
        const nameInput = document.getElementById('player-name');
        console.log('Name input value:', nameInput.value);
        
        if (nameInput.value.trim()) {
          playerName = nameInput.value.trim();
          console.log('Player name set to:', playerName);
          document.getElementById('player-name-display').textContent = playerName;
          showScreen('setup-screen');
          console.log('Switching to setup screen');
        } else {
          alert('Please enter your name!');
        }
      });

      // Allow Enter key to continue
      document.getElementById('player-name').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          document.getElementById('name-continue-btn').click();
        }
      });

      // Setup continue
      document.getElementById('setup-continue-btn').addEventListener('click', function() {
        numHands = parseInt(document.getElementById('num-hands').value);
        minBet = parseInt(document.getElementById('min-bet').value);
        showScreen('deposit-screen');
      });

      // Deposit buttons
      document.querySelectorAll('.deposit-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.deposit-btn').forEach(b => b.classList.remove('selected'));
          this.classList.add('selected');
          document.getElementById('custom-amount').value = this.dataset.amount;
        });
      });

      // Deposit continue
      document.getElementById('deposit-continue-btn').addEventListener('click', function() {
        let amount = parseInt(document.getElementById('custom-amount').value);
        
        if (!amount) {
          const selected = document.querySelector('.deposit-btn.selected');
          if (selected) {
            amount = parseInt(selected.dataset.amount);
          }
        }
        
        if (amount && amount >= 100 && amount <= 100000) {
          balance = amount;
          startingBankroll = amount;
          showScreen('game-container');
          createPlayerHands();
          updateDisplay();
          speak(getRandomQuote('welcome'));
        } else {
          alert('Please enter a valid amount between $100 and $100,000');
        }
      });

      // Navigation tabs
      document.getElementById('game-tab').addEventListener('click', function() {
        document.getElementById('game-area').classList.remove('hidden');
        document.getElementById('stats-page').classList.add('hidden');
        document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
        this.classList.add('active');
      });

      document.getElementById('stats-tab').addEventListener('click', function() {
        document.getElementById('game-area').classList.add('hidden');
        document.getElementById('stats-page').classList.remove('hidden');
        document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
        this.classList.add('active');
        updateStatistics();
      });

      // Chip betting
      document.querySelectorAll('.chip').forEach(chip => {
        chip.addEventListener('click', function() {
          if (gameActive) return;
          
          const amount = parseInt(this.dataset.value);
          
          for (let i = 0; i < playerHands.length; i++) {
            if (playerHands[i].bet === 0) {
              if (balance >= amount && amount >= minBet) {
                playerHands[i].bet = amount;
                balance -= amount;
                updateDisplay();
                updateHandDisplay(i);
                return;
              } else if (amount < minBet) {
                speak(`Minimum bet is ${minBet}, ${playerName}.`);
                return;
              }
            }
          }
          
          if (balance >= amount) {
            playerHands[0].bet += amount;
            balance -= amount;
            updateDisplay();
            updateHandDisplay(0);
          }
        });
      });

      // Game controls
      document.getElementById('deal-btn').addEventListener('click', function() {
        const totalBets = playerHands.reduce((sum, hand) => sum + hand.bet, 0);
        if (totalBets === 0) {
          speak(`Place your bets first, ${playerName}!`);
          return;
        }

        for (let hand of playerHands) {
          if (hand.bet > 0 && hand.bet < minBet) {
            speak(`Minimum bet is ${minBet}, ${playerName}.`);
            return;
          }
        }

        gameActive = true;
        dealerRevealed = false;
        insuranceTaken = false;
        currentHand = 0;

        dealerHand = [];
        for (let i = 0; i < playerHands.length; i++) {
          if (playerHands[i].bet > 0) {
            playerHands[i].cards = [];
            playerHands[i].active = true;
            playerHands[i].finished = false;
          } else {
            playerHands[i].active = false;
            playerHands[i].finished = true;
          }
        }

        document.getElementById('dealer-cards').innerHTML = '';
        for (let i = 0; i < playerHands.length; i++) {
          document.getElementById(`cards-${i}`).innerHTML = '';
        }

        speak(getRandomQuote('deal'));

        stats.totalHands++;
        const totalBet = playerHands.reduce((sum, hand) => sum + hand.bet, 0);
        stats.totalWagered += totalBet;
        stats.betSizes.push(totalBet);

        // Simple dealing for now
        setTimeout(() => {
          // Deal cards
          for (let i = 0; i < playerHands.length; i++) {
            if (playerHands[i].active) {
              dealCardToPlayer(i);
              dealCardToPlayer(i);
            }
          }
          dealCardToDealer(false);
          dealCardToDealer(true);
          
          updateAllDisplays();
          
          // Basic game end for demo
          setTimeout(() => {
            gameActive = false;
            for (let i = 0; i < playerHands.length; i++) {
              if (playerHands[i].active) {
                balance += playerHands[i].bet * 2; // Simple win
                playerHands[i].bet = 0;
                updateHandDisplay(i);
              }
            }
            updateDisplay();
            speak(getRandomQuote('win'));
          }, 2000);
        }, 1000);
      });

      document.getElementById('clear-btn').addEventListener('click', function() {
        if (gameActive) return;
        
        for (let i = 0; i < playerHands.length; i++) {
          balance += playerHands[i].bet;
          playerHands[i].bet = 0;
          updateHandDisplay(i);
        }
        updateDisplay();
      });

      document.getElementById('max-btn').addEventListener('click', function() {
        if (gameActive) return;
        
        const maxBetAmount = Math.floor(balance / numHands);
        if (maxBetAmount >= minBet) {
          for (let i = 0; i < playerHands.length; i++) {
            balance += playerHands[i].bet;
            playerHands[i].bet = maxBetAmount;
            balance -= maxBetAmount;
            updateHandDisplay(i);
          }
          updateDisplay();
        }
      });
    });
  </script>
</body>
</html>
